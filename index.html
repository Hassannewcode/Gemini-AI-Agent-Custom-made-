<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini AI Agent</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNDgiIGhlaWdodD0iNDgiIHZpZXdCb3g9IjAgMCA0OCA0OCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTI0IDRDMTIuOTU0MyA0IDQgMTIuOTU0MyA0IDI0QzQgMzUuMDQ1NyAxMi45NTQzIDQ0IDI0IDQ0QzM1LjA0NTcgNDQgNDQgMzUuMDQ1NyA0NCAyNEM0NCAxMi45NTQzIDM1LjA0NTcgNCAyNCA0WiIgZmlsbD0iIzhBQjRGOCIvPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTI0LjAwMDEgMTJDMjguMjgxOCAxMiAzMi4xMzg0IDEzLjc5MjQgMzQuODE2OCAxNi41ODE2QzMzLjU2MTMgMTguNzA5IDMyLjM5MjYgMjAuOTEwMyAzMS4zMTA2IDIzLjE4NTNDMzAuOTgzOSAyMy45MDA5IDMxLjA1NDYgMjQuNzMzMSAzMS41MjIyIDI1LjM5OThDMzIuOTU4NyAyNy4yNDcxIDM0LjkwODQgMjkuMjE1MiAzNy4zNzMyIDMxLjI5MzNDMzUuNzk3OSAzMy4zMjU5IDMzLjcyNTkgMzQuOTA1NiAzMS4yODQxIDM1LjgwMUMyOS4wNzE1IDM2LjYxMTYgMjYuNjU3NSAzNi41MjYyIDI0LjU3MTQgMzUuNTY4M0MyMC42NzEgMzMuODAxNiAxNy44MDg1IDMwLjE0MTMgMTcuMzg4MiAyNS44MzQ0QzE2Ljk2NzggMjEuNTI3NSAxOS4wNjg5IDE3LjQzMzMgMjIuODQyNyAxNS4zNTI0QzI0Ljg5MTYgMTQuMjg4MiAyNy4yNDU4IDE0LjE2MjMgMjkuNDE4NCAxNC55NDU4QzI4LjUzNjEgMTQuMTI4NyAyNy42NzQ5IDEzLjM4NTcgMjYuODM0NyAxMi43MTY4QzI1Ljk2ODYgMTIuMjQ3MSAyNC45OTk2IDEyIDI0LjAwMDEgMTJaIiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTE2LjU4MTYgMzQuODE2OEMxOC43MDkgMzMuNTYxMyAyMC45MTAzIDMyLjM5MjYgMjMuMTg1MyAzMS4zMTA2QzIzLjkwMDkgMzAuOTgzOSAyNC43MzMxIDMxLjA1NDYgMjUuMzk5OCAzMS41MjIyQzI3LjI0NzEgMzIuOTU4NyAyOS4yMTUyIDM0LjkwODQgMzEuMjkzMyAzNy4zNzMyQzMzLjMyNTkgMzUuNzk3OSAzNC45MDU2IDMzLjcyNTkgMzUuODAxIDMxLjI4NDFDMzYuNjExNiAyOS4wNzE1IDM2LjUyNjIgMjYuNjU3NSAzNS41NjgzIDI0LjU3MTRDMzMuODAxNiAyMC42NzEgMzAuMTQxMyAxNy44MDg1IDI1LjgzNDQgMTcuMzg4MkMyMS41Mjc1IDE2Ljk2NzggMTcuNDMzMyAxOS4wNjg5IDE1LjM1MjQgMjIuODQyN0MxNC4yODgyIDI0Ljg5MTYgMTQuMTYyMyAyNy4yNDU4IDE0Ljk0NTggMjkuNDE4NEMxNC4xMjg3IDI4LjUzNjEgMTMuMzg1NyAyNy42NzQ5IDEyLjcxNjggMjYuODM0N0MxMi4yNDcxIDI1Ljk2ODYgMTIgMjQuOTk5NiAxMiAyNC4wMDAxQzEyIDI4LjI4MTggMTMuNzkyNCAzMi4xMzg0IDE2LjU4MTYgMzQuODE2OFoiIGZpbGw9IndoaXRlIi8+Cjwvc3ZnPgo=" type="image/svg+xml">
</head>
<body>
    <div id="app-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>Gemini Agent</h2>
                <button id="new-chat-button" aria-label="New Chat">
                    <i class="fa-solid fa-plus"></i>
                    New Chat
                </button>
            </div>
            <nav class="sidebar-content">
                <div class="history-list-header">
                    <p>Chat History</p>
                    <button id="clear-history-button" aria-label="Clear all chat history" title="Clear all chat history">
                        <i class="fa-solid fa-broom"></i>
                    </button>
                </div>
                <ul id="chat-history-list">
                    <!-- Chat history will be dynamically inserted here -->
                </ul>
            </nav>
            <div class="sidebar-footer">
                <button id="settings-button">
                    <i class="fa-solid fa-gear"></i>
                    <span>Settings</span>
                </button>
            </div>
        </aside>
        <main class="chat-window">
            <header class="chat-header">
                <h1 id="chat-title" title="Double-click to rename chat">Gemini 2.5 Flash</h1>
            </header>
            
            <!-- Coding Sandbox Panel -->
            <div id="coding-sandbox-container" style="display: none;">
                <div class="sandbox-header">
                    <h3><i class="fa-solid fa-laptop-code"></i> Coding Sandbox</h3>
                    <div class="sandbox-actions">
                        <button id="run-code-button" class="sandbox-button" title="Run Code"><i class="fa-solid fa-play"></i> Run</button>
                        <button id="save-code-button" class="sandbox-button" title="Save file version"><i class="fa-solid fa-save"></i> Save</button>
                        <button id="history-code-button" class="sandbox-button" title="View file history"><i class="fa-solid fa-clock-rotate-left"></i> History</button>
                        <div class="action-divider"></div>
                        <button id="format-code-button" class="sandbox-button" title="Format code"><i class="fa-solid fa-wand-magic-sparkles"></i> Format</button>
                        <button id="download-code-button" class="sandbox-button" title="Download project as .zip"><i class="fa-solid fa-download"></i> Download</button>
                        <div class="action-divider"></div>
                        <button id="close-sandbox-button" class="sandbox-button" title="Close Sandbox"><i class="fa-solid fa-xmark"></i></button>
                    </div>
                </div>
                <div class="sandbox-main">
                    <div class="sandbox-editor-panel">
                        <div id="sandbox-tabs" class="sandbox-tabs">
                           <!-- Tabs are dynamically generated here -->
                           <button id="add-file-button" title="Add new file"><i class="fa-solid fa-plus"></i></button>
                        </div>
                        <div class="sandbox-editor-wrapper">
                             <pre id="sandbox-code-pre" aria-hidden="true"><code id="sandbox-code-highlight" class="language-js"></code></pre>
                             <textarea id="sandbox-code-editor" spellcheck="false" aria-label="Code Editor"></textarea>
                        </div>
                    </div>
                    <div id="sandbox-resizer" class="sandbox-resizer"></div>
                    <div class="sandbox-preview-panel">
                        <div class="sandbox-preview-header">
                            <span id="sandbox-preview-title">Preview</span>
                            <button id="fullscreen-button" title="Toggle Fullscreen"><i class="fa-solid fa-expand"></i></button>
                        </div>
                        <div class="sandbox-preview-content">
                            <iframe id="sandbox-preview-iframe" sandbox="allow-scripts allow-modals allow-popups allow-presentation allow-same-origin" title="Code Preview"></iframe>
                            <div id="sandbox-console">
                                <div class="console-header">Console</div>
                                <div id="console-output"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="chat-messages" class="chat-messages" aria-live="polite">
                <!-- Chat messages will be dynamically inserted here -->
            </div>
            
            <!-- Cloud Browser Preview Panel -->
            <div id="cloud-browser-preview" class="cloud-browser-preview" style="display: none;">
                <!-- Content will be dynamically inserted here -->
            </div>

            <div class="chat-input-area">
                <div class="chat-input-toolbar">
                    <label class="search-toggle-container" for="search-toggle" title="Enable to search the web for answers">
                        <input type="checkbox" id="search-toggle">
                        <span class="slider"></span>
                        <span>Search the web</span>
                    </label>
                     <label class="search-toggle-container" for="coding-toggle" title="Enable to generate code in a sandbox">
                        <input type="checkbox" id="coding-toggle">
                        <span class="slider"></span>
                        <span>Coding Sandbox</span>
                    </label>
                </div>
                <form id="chat-form" class="chat-form">
                    <textarea id="chat-input" placeholder="Type your message here..." required></textarea>
                    <button type="submit" id="send-button" aria-label="Send Message">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <line x1="22" y1="2" x2="11" y2="13"></line>
                            <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                        </svg>
                    </button>
                </form>
            </div>
        </main>
    </div>

    <!-- AI Action Confirmation Modal -->
    <div id="ai-action-modal" class="modal-overlay">
        <div class="modal-content">
            <h3>AI Action Required</h3>
            <p>The AI wants to perform the following actions on your sandbox files. Do you approve?</p>
            <ul id="ai-action-list" class="ai-action-list">
                <!-- Actions will be populated here -->
            </ul>
            <div class="modal-buttons">
                <button id="deny-ai-action-button" class="modal-button cancel">Deny</button>
                <button id="allow-ai-action-button" class="modal-button confirm">Allow</button>
            </div>
        </div>
    </div>
    
    <!-- Generic Confirmation Modal -->
    <div id="confirm-modal" class="modal-overlay">
        <div class="modal-content">
            <h3 id="confirm-modal-title">Are you sure?</h3>
            <p id="confirm-modal-text">This action cannot be undone.</p>
            <div class="modal-buttons">
                <button id="confirm-modal-cancel" class="modal-button cancel">Cancel</button>
                <button id="confirm-modal-confirm" class="modal-button danger">Confirm</button>
            </div>
        </div>
    </div>


    <!-- Clear History Confirmation Modal -->
    <div id="clear-history-modal" class="modal-overlay">
        <div class="modal-content">
            <h3>Clear All History?</h3>
            <p class="modal-warning">
                <strong>DANGER:</strong> This action is irreversible and will permanently delete all of your conversations.
            </p>
            <p>To confirm, please type the following text into the box below:</p>
            <p class="confirmation-phrase">Clear all of my chat history</p>
            <input type="text" id="confirm-clear-input" class="modal-input" placeholder="Type to confirm..." autocomplete="off">
            <div class="modal-buttons">
                <button id="cancel-clear-button" class="modal-button cancel">Cancel</button>
                <button id="confirm-clear-button" class="modal-button confirm" disabled>Clear History</button>
            </div>
        </div>
    </div>

    <!-- Request Sandbox Modal -->
    <div id="request-sandbox-modal" class="modal-overlay">
        <div class="modal-content">
            <h3>Enable Coding Sandbox?</h3>
            <p id="request-sandbox-text">The AI suggests this request would be better handled in the interactive coding sandbox. Would you like to enable it and resubmit your request?</p>
            <div class="modal-buttons">
                <button id="cancel-sandbox-request-button" class="modal-button cancel">No, Thanks</button>
                <button id="confirm-sandbox-request-button" class="modal-button confirm">Enable and Resend</button>
            </div>
        </div>
    </div>

    
    <!-- Settings Modal -->
    <div id="settings-modal" class="modal-overlay">
        <div class="modal-content">
            <h3>Settings</h3>
            <button id="close-settings-button" class="modal-close-button" aria-label="Close settings"><i class="fa-solid fa-xmark"></i></button>

            <div class="setting-item">
                <label for="theme-selector">Theme</label>
                <select id="theme-selector" class="modal-input">
                    <option value="dark">Dark</option>
                    <option value="light">Light</option>
                </select>
            </div>
             <div class="setting-item">
                <label for="temperature-slider">AI Temperature (<span id="temperature-value">0.5</span>)</label>
                <input type="range" id="temperature-slider" min="0" max="1" step="0.1" value="0.5" class="modal-slider">
            </div>
            <div class="setting-item">
                <label for="typing-speed-slider">AI Typing Speed (<span id="typing-speed-value">800</span> WPM)</label>
                <input type="range" id="typing-speed-slider" min="50" max="5000" step="50" value="800" class="modal-slider">
            </div>
            
            <div class="danger-zone">
                <h4>Advanced</h4>
                <div class="setting-item">
                     <p>Download the current sandbox project as a .zip file.</p>
                     <button id="export-zip-button" class="modal-button confirm">Download Project</button>
                </div>
                <div class="setting-item">
                     <p>Clear all files from the coding sandbox for this chat.</p>
                     <button id="clear-sandbox-button" class="modal-button danger">Clear Sandbox</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- File History Modal -->
    <div id="file-history-modal" class="modal-overlay">
        <div class="modal-content wide">
            <h3 id="file-history-title">File History</h3>
            <button id="close-history-button" class="modal-close-button" aria-label="Close history"><i class="fa-solid fa-xmark"></i></button>
            <div class="file-history-main">
                <div class="history-version-list-container">
                    <h4>Versions</h4>
                    <ul id="history-version-list">
                        <!-- Version history will be populated here -->
                    </ul>
                </div>
                <div class="history-code-viewer">
                    <pre id="history-code-pre" aria-hidden="true"><code id="history-code-highlight" class="language-js"></code></pre>
                </div>
            </div>
            <div class="modal-buttons">
                <button id="restore-history-button" class="modal-button confirm">Restore this version</button>
            </div>
        </div>
    </div>


    <!-- Sandbox File Context Menu -->
    <div id="sandbox-context-menu" class="custom-context-menu">
        <ul>
            <li id="context-rename"><i class="fa-solid fa-pen-to-square fa-fw"></i> Rename</li>
            <li id="context-delete"><i class="fa-solid fa-trash-can fa-fw"></i> Delete</li>
        </ul>
    </div>
    
    <!-- Message Context Menu -->
    <div id="message-context-menu" class="custom-context-menu">
        <ul>
            <li id="message-context-copy"><i class="fa-solid fa-copy fa-fw"></i> Copy Text</li>
            <li id="message-context-copy-raw"><i class="fa-solid fa-code fa-fw"></i> Copy Raw JSON</li>
            <li id="message-context-retry"><i class="fa-solid fa-rotate-right fa-fw"></i> Retry Response</li>
        </ul>
    </div>


    <!-- Toast Notification Container -->
    <div id="toast-container"></div>


    <script type="importmap">
    {
        "imports": {
            "@google/genai": "https://esm.sh/@google/genai@^0.12.0",
            "jszip": "https://esm.sh/jszip@3.10.1",
            "file-saver": "https://esm.sh/file-saver@2.0.5"
        }
    }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/prettier@2.8.8/standalone.js"></script>
    <script src="https://unpkg.com/prettier@2.8.8/parser-html.js"></script>
    <script src="https://unpkg.com/prettier@2.8.8/parser-babel.js"></script>
    <script src="https://unpkg.com/prettier@2.8.8/parser-postcss.js"></script>
    <script type="module" src="index.tsx"></script>
</body>
</html>
